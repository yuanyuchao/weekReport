<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta charset="utf-8">
<title id="title" >购买</title>
<script src="../js/jquery.min.js"></script>
<link rel="stylesheet" href="lay/layui.css" rel="stylesheet" type="text/css">
<script src="lay/layui.js"></script>
<script src="../js/rem.js"></script>

<style type="text/css">
body,html,div,span,li,h1,h2,h3,h4,h5,h6{
		margin:0;
		padding:0;
}
html{ 
	width:100%;
	height:100%;
	overflow-x:hidden;
}

body{
	width:100%;
	height:100%;
	box-sizing: border-box;
	-webkit-box-sizing:border-box;
	padding-top:0.1rem;
	background-color: #f9f9f9;
}

.tab {
	background-color: white;
	width: 100%;
	box-sizing: border-box;
}

* {
	font-size: 12px;
}

.input {
	width: 100%;
	height: 30px;
	border:1px solid #999999;
	-webkit-appearance: none;
}


#amt {
	width: 100%;
	height: 1.16rem;
	font-size: 0.44rem;
	font-family: 微软雅黑;
	color:rgba(51,51,51,1);
	-webkit-appearance: none;
}

.btnSubmit {
	width: 100%;
	height: 40px;
	border-radius: 5px;
	background-color: #e5a649;
	color: white;
	border: 0px;
}

.showHb{
	
    vertical-align: middle;
	text-align: center;
	width: 100%;
	height: 40px;
	border-radius: 5px;
	background-color: #e5a649;
	color: white;
	border: 0;
	
}

::-webkit-input-placeholder { /* WebKit browsers */
	color: #ccc;
	font-size: 0.28rem;
}

:-moz-placeholder { /* Mozilla Firefox 4 to 18 */
	color: #ccc;
}

::-moz-placeholder { /* Mozilla Firefox 19+ */
	color: #ccc;
}

:-ms-input-placeholder { /* Internet Explorer 10+ */
	color: #ccc;
}

#loading {
	position: absolute;
	width: 100%;
	height: 100%;
	background-color: #f9f9f9;
	top: 0px;
	z-index: 100;
	display: none;
}

#showAll {
	position: absolute;
	width: 100%;
	height: 100%;
	box-sizing: border-box;
	padding:0.1rem 0.2rem;
	top: 0px;
	background-color:rgba(249,249,249,1);
	z-index: 100;
	display: none;
}

.clean{
	float:left;
	/*display:none; */
	margin-top:0.13rem;
	margin-left:0.50rem;
	width: 0.24rem;
	height: 0.24rem;
	background: url(img/clean.png) no-repeat 0 0;
	background-size: contain;
}

.tab {
	background-color: white;
	padding:0.1rem;
	width: 7.1rem;
}

.bid{
    	width: 100%;
    	margin:0.12rem 0;
    	background-color: white;
    }
    .bid div{
    	height: 0.88rem;
    	width: 100%;
    	box-sizing: border-box;
    	padding:0.3rem 0.24rem;
    	display: flex;
    	align-items: center;
    	border-bottom: 1px solid #eee;
    	font-size: 0.28rem;
    }
    .bid div span:first-child{
    	display: inline-block;
    	height: 0.28rem;
    	width: 2rem;
    	line-height: 0.28rem;
    }
    .bid div span:last-child{
    	display: inline-block;
    	height: 0.28rem;
    	line-height: 0.28rem;
    }

    .buy{
    	box-sizing: border-box;
    	padding:0.36rem 1.55rem 0;
    	background-color: white;
    	border-bottom: 0.01rem solid #eee;
    	height: 2.8rem;
    }

    .buy input{
    	display: block;
    	width: 100%;
    	height: 0.86rem;
    	border:0;
    	border-bottom:0.01rem solid #eee;
    	font-size: 0.36rem;
    	text-align: center;
    	margin-bottom: 0.30rem;
    	-webkit-appearance: none;
    }
    /*input:focus {
	    outline:none;
	}*/
	.buy p{
		display: block;
		height: 0.28rem;
		width: 100%;
		text-align: center;
		font-size: 0.28rem;

	}
	.buy p span{
		display: inline-block;
		height: 0.28rem;
		width: 1.2rem;
		font-size: 0.28rem;
		color: #FF5E33;
	}
	.bid input{
		outline:none;
		border:0;
		-webkit-appearance: none;
		width:4rem;
		height: 0.36rem;
    	line-height: 0.36rem;
		font-size: 0.28rem;
    	color: #666666;
	}
	.bid div span:first-child{
		font-size: 0.28rem;
		color:#666666;
	}
	.bid div span:last-child{
		font-size: 0.36rem;
	}
	.bidBot{
		width: 0.7rem;
		box-sizing: border-box;
		padding:0.2rem 0.35rem;
	}
	.bidBot div{
		height: 0.68rem;
		width: 6.8rem;
		border-radius: 5px;
		background-color: #FF5E33;
		color: white;
		text-align: center;
		font-size:0.3rem;
		line-height: 0.68rem;
	}
	.check{
		height: 0.3rem;
		width: 100%;
		font-family: 微软雅黑;
    	display: flex;
    	align-items: center;
    	box-sizing: border-box;
		padding:0.36rem 0.24rem;
		font-size: 0.3rem;
		line-height: 0.3rem;
    }
    .tick{
    	height: 0.28rem;
    	width: 0.28rem;
    	background:url(img/nosel.png) no-repeat 0 0;
    	background-size: contain;
    	float: left;
    	margin-right: 0.14rem;
    }
    #hbtj{
    	float:right;
    	width: 5rem;
    	text-align:left ;
    	font-size: 0.28rem;
    	color:#cacaca;
    }
    #hbtj font{
    	display: block;
    	width: 0.24rem;
    	height: 0.24rem;
    	float: right;
    }
    .detail{
    	width: 100%;
    	height: 1.54rem;
    	box-sizing: border-box;
    	padding: 0.4rem 0;
    	background-color: rgba(255,255,255,1);
    }
    .shenyu,.xiane{
    	float:left;
    	width: 2.5rem;
    	height: 100%;
    }
    .ketou{
    	float: left;
    	width: 2.4rem;
    	height: 100%;
    	border-right: 0.01rem solid rgba(202,202,202,1);
    	border-left: 0.01rem solid rgba(202,202,202,1);
    }
    .detail div span{
    	display: block;
    	width: 100%;
    	height: 0.24rem;
    	font-size: 0.24rem;
    	text-align: center;
    	line-height: 0.24rem;
    	font-family: 微软雅黑;
    }
    .detail div span:first-child{
    	margin-bottom: 0.26rem;
    	color: rgba(102,102,102,1);
    }
     .detail div span:last-child{
    	color:rgba(153,153,153,1);
    }
    .yhxe{
    	font-size: 0.24rem;
    	display: block;
    	height: 0.72rem;
    	box-sizing: border-box;
    	padding: 0.24rem;
    	line-height: 0.24rem;
    	color: rgba(102,102,102,1);
    	background-color: rgba(249,249,249,1);
    }


    
    .hbground{
		width: 100%;
		height: 2.06rem;
		box-sizing: border-box;
		padding: 0.55rem 0.4rem  0.4rem 0.4rem;
		background:url(img/hbbg.png) no-repeat 0 0;
		background-size: contain;
		margin-bottom: 0.24rem;
	}
	.jxqground{
		width: 100%;
		height: 2.06rem;
		box-sizing: border-box;
		padding: 0.55rem 0.4rem  0.4rem 0.4rem;
		background:url(img/jxqbg.png) no-repeat 0 0;
		background-size: contain;
	}
	.hbleft{
		width: 3.8rem;
		height: 100%;
		float: left;
	}
	.hbright{
		width: 2.5rem;
		height: 100%;
		float: left;
	}
	.hbmoneywrap{
		width: 100%;
		height: 0.54rem;
		position: relative;
		margin-bottom: 0.3rem;
	}
	
	
	.hbask{
		width: 100%;
		height: 0.26rem;
		font-size: 0.26rem;
		line-height: 0.26rem;
		font-family: 微软雅黑;
		color: rgba(102,102,102,1);
	}
	.yxq{
		display: block;
		width: 100%;
		height: 0.26rem;
		font-size: 0.26rem;
		line-height: 0.26rem;
		text-align: center;
		color: rgba(153,153,153,1);
		margin-bottom: 0.1rem;
	}
	.hbtimeend{
		display: block;
		width: 100%;
		height: 0.22rem;
		font-size: 0.28rem;
		line-height: 0.22rem;
		text-align:center;
		color: rgba(102,102,102,1);
		margin-bottom: 0.24rem;
	}
	.hbtitle,.jxqtitle{
		display: block;
		width: 100%;
		height: 0.28rem;
		line-height: 0.28rem;
		color: rgba(255,94,51,1);
		text-align: center;
		font-size: 0.28rem;
	}
	.rmb,.jxq{
		position: absolute;
		bottom:0rem;
		width: 0.22rem;
		height: 0.28rem;
		color: rgba(255,94,51,1);
		font-size: 0.36rem;
		margin-right: 0.3rem;
		line-height: 0.28rem;
	}
	.jxq{
		left: 1.1rem;
		color:rgba(255,153,59,1)
	}
	.hbmoney,.jxqmoney{
		position: absolute;
		top:0;
		left: 0.4rem;
		width: 3rem;
		height: 0.54rem;
		color: rgba(255,94,51,1);
		font-size: 0.72rem;
		line-height: 0.54rem;
	}
	.jxqmoney{
		left: 0;
		color:rgba(255,153,59,1);
	}
	.jxqtitle{
		color: rgba(255,153,59,1);
	}
	.subBank{
		/*position:absolute;
		bottom: 0.5rem; */
		display: block;
		
		width: 100%;
		height: 0.28rem;
		line-height: 0.28rem;
		color: rgba(47,197,92,1);
		text-align: center;
		font-size: 0.28rem;
		
	}
	.register,.unregister{
		display: none;
	}
	.fail{
		display: none;
		width: 4rem;
		height: 4rem;
		position: relative;
		top: 1.6rem;
		left: 50%;
		margin-left: -2rem;
	}
</style>
</head>
<body> 
<!-- <div id="loading">
	<table style="width: 100%;height: 100%;">
		<tr>
			<td style="text-align: center;">下单中...</td>
		</tr>
	</table>
</div> -->

<div style="position: absolute;width:100%;height:100%;">
	<form id="form1" action=" https://www.etongjin.net/borrow/postFuiouPay" method="post">
		<input name="userId" id="userId" type="hidden" value="" />
	    <input name="borrowId" id="borrowId" type="hidden" value="" />
	    <input name="channel" id="channel" type="hidden" value="" />
	    <!-- <input name="usehbToken" id="usehbToken" type="hidden" value="" /> -->
	    <input name="imei" id="imei" type="hidden" value="" />
	    <input name="hbid" id="hbid" type="hidden" />
	     <div class="buy">
			<input onkeyup="this.value=this.value.replace(/\D/g,'')" onafterpaste="this.value=this.value.replace(/\D/g,'')" type="number" name="amt" id="amt" placeholder="请输入购买整数金额">
			<p>预期收益:<span style="color:#FF5E33;" id="expectedEarnings" >0.00</span>元</p>
		 </div>
	     <div class="detail">
	     	<div class="shenyu">
	     		<span class="remmoney"></span>
	     		<span>剩余可投(元)</span>
	     	</div>
	     	<div class="ketou">
	     		<span class="lowestAccount"></span>
	     		<span>起投金额(元)</span>
	     	</div>
	     	<div class="xiane">
	     		<span class="mostAccount"></span>
	     		<span>限额(元)</span>
	     	</div>
	     </div>

	     
	
		<div class="bid unregister">
				<div>
					<span>银行卡号 :</span>
					<input  type="number" name="bank_card" id="bank_card" placeholder="请输入你的银行卡号">
				</div>
				<div>
					<span>真实姓名 :</span>
					<input type="" name="name" id="name" placeholder="请输入你的真实姓名">
				</div>
				<div>
					<span>身份证号 :</span>
					<input type="" name="pid" id="pid" placeholder="请输入你的身份证号">
				</div>
		</div>
		<div class="bid register">
			<div>
				<span>银行卡号 </span>
				<span style="font-size:0.28rem;" class="bankCardName"></span>
			</div>
			<p class="yhxe">
				单笔限额<span class="danbi"></span>万元 单日限额<span class="danri"></span>万元
			</p>
		</div>
	    <div class="bid">
			<div>
				<span style="float: left;">使用红包</span>
				<span style="float: right;" class="hbDetail" id="hbtj">输入出借金额后显示可用福利券<font>&gt</font> </span>
			</div>
		</div>
	
		<!-- <p class="check"><span></span>我已阅读并同意<span style="color: #FF5E33">《借款合同》《风险提示告知书》</span></p> -->
		<div class="check"><div class="tick"></div>我已阅读并同意<span style="color: #FF5E33" class="showht">《借款合同》</span><span style="color: #FF5E33" class="showfx">《风险提示告知书》</span></div>
		<div class="bidBot">
			<div class="btnSubmit">立即出借</div>
		</div>
	</form>
	<p class="subBank">查看支持银行及限额</p>
</div>

<div id="fuiouPostFormDiv">

</div>




<!-- 选择红包 -->
<div id="showAll">
	<div style="width:7.5rem;height:0.88rem;font-size:0.28rem;font-family: 微软雅黑;color: rgba(102,102,102,1);text-align: center;background-color: white;margin-left: -0.2rem;line-height: 0.88rem;margin-bottom: 0.2rem;margin-top:0.1rem;" class="nothb">不使用福利券</div>
	<div id="showAllHb"></div>
</div>
<script type="text/javascript">
   	$(document).ready(function(){



   		var u = navigator.userAgent, app = navigator.appVersion;   
		var isAndroid = u.indexOf('Android') > -1 || u.indexOf('Linux') > -1; //android终端或者uc浏览器   
		var isiOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端   


   		if(isAndroid){
		    //注册事件监听
	        function setupWebViewJavascriptBridge(callback) {

	            if (window.WebViewJavascriptBridge) {
	                callback(WebViewJavascriptBridge)
	            }else{
	                document.addEventListener(
	                    'WebViewJavascriptBridgeReady'
	                    , function() {
	                        callback(WebViewJavascriptBridge)
	                    },
	                    false
	                );
	            }
	        }

	        setupWebViewJavascriptBridge(function(bridge) {
	               bridge.init(function(message, responseCallback) {
	                   var responseData = '默认接收收到来自Java的数据，回传数据给你';
	                   responseCallback(responseData);
	               });

	              
	               bridge.callHandler('getUserTokenAndUUID',"123456",function(responseData) {
	                    var responseData = JSON.parse(responseData);
                        version = responseData.version;
	                    token = responseData.token;
	                    uid = responseData.uuid;
	                    channel = responseData.channel;
	                    borrowId = parseInt(responseData.borrowId);
	                    getIndex(token,uid,channel,borrowId,version);
	               });
	          });


		}
		/*if(isiOS){
			console.log(33333);
			alert(22222);
			function setupWebViewJavascriptBridge(callback) {

		    if (window.WebViewJavascriptBridge) { return callback(WebViewJavascriptBridge); }
		    if (window.WVJBCallbacks) { return window.WVJBCallbacks.push(callback); }
		    window.WVJBCallbacks = [callback];
		    var WVJBIframe = document.createElement('iframe');
		    WVJBIframe.style.display = 'none';
		    WVJBIframe.src = 'wvjbscheme://__BRIDGE_LOADED__';
		    document.documentElement.appendChild(WVJBIframe);
		    setTimeout(function() { document.documentElement.removeChild(WVJBIframe) }, 0)
		    }
		    setupWebViewJavascriptBridge(function(bridge) {		                             
			    bridge.callHandler('getUserTokenAndUUID',function callback(response) {

			    	
			    	token = response.token;
			    	uid = response.uuid;
			    	channel = response.channel;
			    	borrowId = parseInt(response.borrowId);
			    	getIndex(token,uid,channel,borrowId);
			    })   
			});
		}
*/
	
		


		var subBankH = ($("body").height() - $("form").height()) * 0.3;
		$(".subBank").css("margin-top",subBankH+"px");

	    var usehbToken = "";
	   //初次跳转填充已有数据
	   $(".btnSubmit").unbind();

	   var flag = 0;
	    $(".tick").click(function(){
	      	if(flag == 0){
		    	$(this).css("background-image","url(img/sel.png)");
		        flag = 1;

	      	}else if(flag == 1){ 
		        $(this).css("background-image","url(img/nosel.png)");
		        flag = 0;
	      	}
	    });


	    var getIndex = function(token,uid,channel,borrowId,version){
	    	$.ajax({
			type: 'POST',
			url: "http://112.17.92.53:8081/borrow/toBorrowOrder/auth" ,
			headers:{"token":token,"uid":uid},
			data:{"borrowId":borrowId,"channel":channel},
			success:function(data){
				if(data.code == 200){
					var data = data.data;
					$(".remmoney").text(data.remmoney);
					$(".lowestAccount").text(data.lowestAccount);
					if(data.mostAccount == 0){
						$(".mostAccount").text("无限额");
					}else{
						$(".mostAccount").text(data.mostAccount);
					}
					if(data.bankCardName !== ""){
						
						$(".register").css("display","block");
						$(".unregister").css("display","none");
						$(".subBank").css("display","block");
						$(".bankCardName").text(data.bankCardName + "(尾号" + data.shortCard +")");
						if(data.ymoney == undefined){
							$(".yhxe").css("display","none");
						}else{
							$(".danbi").text(data.ymoney);
							$(".danri").text(data.dmoney);
						}
					}else{
						$(".register").css("display","none");
						$(".unregister").css("display","block");
						$(".subBank").css("display","block");
					}
					window.usehbToken = data.usehbToken;
					// 存储有效数据
					localStorage.setItem("version",version);
					localStorage.setItem("borrowId",borrowId);
					localStorage.setItem("uid",uid);
					localStorage.setItem("channel",channel);
					localStorage.setItem("token",token);
					localStorage.setItem("shortCard",data.shortCard);
					localStorage.setItem("bankCardName",data.bankCardName);
					localStorage.setItem("usehbToken",data.usehbToken);
					localStorage.setItem("apr",data.apr);
					localStorage.setItem("day",data.day);
					localStorage.setItem("bankCard",data.bankCard);
					/*$('#amt').removeAttr("disabled");*/
                    isClick = false;
					$(".btnSubmit").on("click",function() {
                        if(isClick == true) return;
                        isClick = true;
						if(localStorage.getItem("shortCard") !== ""){
							var p = {
								t:new Date(),
								borrowId:localStorage.getItem("borrowId"),
								amt:$("#amt").val(),
								bankCard:localStorage.getItem("bankCard"),
								channel:localStorage.getItem("channel"),
								usehbToken:window.usehbToken,
								imei:"im",
								hbid:$("#hbid").val(),
                                version:localStorage.getItem("version")
							}
						}else{
							var p = {
								t:new Date(),
								borrowId:localStorage.getItem("borrowId"),
								amt:$("#amt").val(),
								bankCard:$("#bank_card").val(),
								name:$("#name").val(),
								pid:$("#pid").val(),
								hbid:$("#hbid").val(),
								channel:localStorage.getItem("channel"),
								usehbToken:window.usehbToken,
								imei:"im",
                                version:localStorage.getItem("version")
							}
						}
						
						if($(".bankCardName").text() != ""){
							if($("#amt").val() > data.remmoney){
                                isClick = false;
								alert("可购金额不足");
								return;
							}
							if($("#amt").val() < 100){
                                isClick = false;
								alert("购买金额小于100");
								return;
							}
							if (!/^[0-9]+$/.test(p.amt)) {
                                isClick = false;
								alert("输入购买金额");
								return;
							} 
							if( flag == 0 ){
                                isClick = false;
								alert("请同意协议");
								return;
							}
						}else{
							if($("#amt").val() > data.remmoney){
                                isClick = false;
								alert("可购金额不足");
								return;
							}
							if($("#amt").val() < 100){
                                isClick = false;
								alert("购买金额小于100");
								return;
							}
							if (!/^[0-9]+$/.test(p.amt)) {
                                isClick = false;
								alert("输入购买金额");
								return;
							} 
							
							if (!/^[0-9]+$/.test(p.bankCard)) {
                                isClick = false;
								alert("输入银行卡号");
								return;
							}
							if (!p.name) {
                                isClick = false;
								alert("输入姓名");
								return;
							}
							var regIdNo = /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/; 
							if (!regIdNo.test(p.pid)) {
                                isClick = false;
								alert("身份证号格式错误");
								return;
							}
							if( flag == 0 ){
                                isClick = false;
								alert("请同意协议");
								return;
							}
						}
						createOrder(p);
					});
				}else if(data.code == 406){
                    isClick = false;
					$("body").empty();
					$("body").append('<img class="fail" style="display:block;" src="img/network_anomaly@2x.png">');
				}else{
                    isClick = false;
					$(".register").css("display","none");
					$(".unregister").css("display","block");
					$(".subBank").css("display","block");
				}
			}
		})
	    }
        
	    $(".showht").click(function(){
		   	/*var userid = $("#userId").val();
		   	var id = $("#borrowId").val();
		   	localStorage.setItem("buyamt",$("#amt").val());
		   	console.log(localStorage.getItem("buyamt"));*/
		   	localStorage.setItem("buyamt",$("#amt").val());
		   	window.location.href = "https://www.etongjin.net/app4.0/Investment/contractAndroid.html";
	    });
		   
		$(".showfx").click(function(){
		    window.location.href="https://www.etongjin.net/html/inform.html";
	    });
		
		$(".subBank").click(function(){
		    window.location.href="https://www.etongjin.net/html/yhxe.html";
	    });
		   
		$("#amt").on('input propertychange',function(){
			var buyamt = $(this).val();
			var rate = localStorage.getItem("apr");
			var day = localStorage.getItem("day");
			buyamt = buyamt * rate / 36500 * day;
			$("#showAllHb").empty();
			$("#expectedEarnings").text(buyamt.toFixed(2));
		    $.ajax({
		   	    type: 'POST',
			    url: "http://112.17.92.53:8081/activity/availableHb/auth" ,
				headers:{"uid":localStorage.getItem("uid"),"token":localStorage.getItem("token")},
				data:{"borrowId":localStorage.getItem("borrowId"),"buyAmt":$("#amt").val(),"type":"hbcount","page":"1"},
				success:function(data){
					if(data.code == 200){
						if(data.data.hbcount > 0){
				    		$("#hbtj").html(data.data.hbcount+"张券可用");
				    	}else{
				    		$("#hbtj").html("无券可用");
				    	}
					}
				}
		    })
		});
		   
	   
		
			
		$(".hbDetail").click(function(){
			if($("#amt").val() == ""){
				alert("请输入投资金额");
			}else{
				$("#showAll").show();
			$("#showAllHb").empty();
			$("#title").html("选择优惠");
			 //流加载红包
			 layui.use('flow', function(){
				  var flow = layui.flow;
				  flow.load({
				    elem: '#showAllHb', //流加载容器
				    //scrollElem: '#LAY_demo1', //滚动条所在元素，一般不用填，此处只是演示需要。
				    done: function(page, next){ //执行下一页的回调
				    	$.ajax({
				    		type: 'POST',
						    url: "http://112.17.92.53:8081/activity/availableHb/auth" ,
							headers:{"uid":localStorage.getItem("uid"),"token":localStorage.getItem("token")},
							data:{"borrowId":localStorage.getItem("borrowId"),"buyAmt":$("#amt").val(),"type":"hblist","page":page},
							success:function(data){
								if(data.code == 200){
									setTimeout(function(){
					                 var lis = [];
									 var jsonData = data;
									 /*var jsonResult = jsonData['pacPage'];*/
									 var jsonPac = data.data.hblist;
									 $.each(jsonPac, function(i, item){
									    var ht = "";
									    if( item["hbtype"] == 1 ){
											var ht = "<div class='hbground' data-hbid="+item["hbid"]+" data-hbmoney="+item["hbmoney"]+" data-hbtype="+item["hbtype"]+">";
										}else if( item["hbtype"] == 2 ){
											var ht = "<div class='jxqground' data-hbid="+item["hbid"]+" data-hbmoney="+item["hbmoney"]+" data-hbtype="+item["hbtype"]+">";
										}
										ht += "<div class='hbleft'>";
										ht += "<div class='hbmoneywrap'>";
										if( item["hbtype"] == 1 ){
											ht += "<span class='rmb'>￥</span>";
										}
										if( item["hbtype"] == 2 ){
											ht += "<span class='jxq'>%</span>";
										}
										if( item["hbtype"] == 1 ){
											ht += "<span class='hbmoney'>"+ item["hbmoney"] +"</span>";
										}
										if( item["hbtype"] == 2 ){
											ht += "<span class='jxqmoney'>"+ item["hbmoney"] +"</span>";
										}
										
										ht += "</div>";
										ht += "<div class='hbask'>"+ item["hbdetail"]+"</div>";
										ht += "</div>";
										ht += "<div class='hbright'>";
										ht +="<span class='yxq'>有效期至</span>";
										ht +="<span class='hbtimeend'>"+item["hbendtime"].substring(0,11)+"</span>";
										if( item["hbtype"] == 1 ){
											ht +="<span class='hbtitle'>"+item["hbname"]+"</span>";
										}
										if( item["hbtype"] == 2 ){
											ht +="<span class='jxqtitle'>"+item["hbname"]+"</span>";
										}
										
										ht += "</div>";
										ht += "</div>";

									      lis.push(ht);
									 });
									 next(lis.join(''), page < jsonData.data["totalSize"]); //假设总页数为 10
							      }, 500);
								}
							}
				    	})
				    }
				});
			});
			}
			
		});
			
		$("#showAllHb").on("click",".hbground",function(){
			$("#hbid").val($(this).attr("data-hbid"));
			
			var hbtype = $(this).attr("data-hbtype");
			if( hbtype == 1 ){
				$("#hbtj").html($(this).attr("data-hbmoney")+"元红包");
			}else if( hbtype == 2 ){
				$("#hbtj").html($(this).attr("data-hbmoney")+"%加息劵");
			}
			$(".clean").css("display","block");
			$("#title").html("购买");
			$("#showAll").hide();
	    });

	    $("#showAllHb").on("click",".jxqground",function(){
			$("#hbid").val($(this).attr("data-hbid"));
			
			var hbtype = $(this).attr("data-hbtype");
			if( hbtype == 1 ){
				$("#hbtj").html($(this).attr("data-hbmoney")+"元红包");
			}else if( hbtype == 2 ){
				$("#hbtj").html($(this).attr("data-hbmoney")+"%加息劵");
			}
			$(".clean").css("display","block");
			$("#title").html("购买");
			$("#showAll").hide();
	    });
			
			
		$("#hbmoney").click(function(){
			if($("#hbmoney").text() != ""){
				$(".clean").css("display","block");
			}
		});
		
		$(".clean").click(function(){
			$(".clean").css("display","none");
			$("#hbmoney").text("");
			$("#hbid").val("");
		});
			
		$(".nothb").click(function(){
			$("#showAll").hide();
			$("#hbtj").html("不使用福利券");
			$("#title").html("购买");
			//$("#hbmoney").text("");
			$("#hbid").val("");
		});
	
	var createOrder=function(p){
		/*alert("loading");*/
		$.ajax({
			type: 'POST',
		    url: "http://112.17.92.53:8081/borrow/postFuiouPay/auth" ,
			headers:{"uid":localStorage.getItem("uid"),"token":localStorage.getItem("token")},
			data:p,
			success:function(data){
                isClick = false;
                if(data.code==200){
                    setupWebViewJavascriptBridge(function(bridge) {
                        bridge.callHandler('TimeOut',{'orderId':data.data.orderId,'time':data.data.timeout},function(responseData) {
                            $("#fuiouPostFormDiv").html(data.data.payForm);
                            $("#fuiouPostFormDiv").find("form").submit();
                            /*alert("loadingout");*/
                        });
                    });
                    if(localStorage.getItem("version") == "undefined"){
                        $("#fuiouPostFormDiv").html(data.data.payForm);
                        $("#fuiouPostFormDiv").find("form").submit();
                        /*alert("loadingout");*/
                    }

                    return;
                }
				if(data.code == 400){
					/*alert("loadingout");*/
					alert(data.msg);
					return;
				}
				/*erroMsg = data.code.split(":");
				alert(erroMsg.length==2?erroMsg[1]:"系统维护中,稍等购买...");*/
			},
			error:function () {
                isClick = false;
            }

		})
	};

	});
		
	

	</script>
</body>
</html>
